# 6장 메시지와 인터페이스

## Reference

- [오브젝트 - 조영호 저자(글)](https://product.kyobobook.co.kr/detail/S000001766367)

객체지향 프로그래밍에 가장 흔한 오해는 애플리케이션이 클래스의 집합으로 구성된다는 것이다. 전체 개발 활동의 중심에 클래스를 놓는다.

훌륭한 객체지향 코드를 얻기 위해서는 클래스가 아니라 객체를 지향해야 한다. 조금 더 정확하게 말하자면 객체가 수행하는 책임에 초점을 맞추어야 한다. 중요한 점은 책임이 객체가 수신할 수 있는 메시지의 기반이 된다는 것이다.

## 협력과 메시지

## 클라이언트-서버 모델

협력은 어떤 객체가 다른 객체에게 무엇인가를 요청할 때 시작하게 된다. 메시지는 객체 사이의 협력을 가능하게 하는 매개체이다.

두 객체 사이의 협력 관계를 설명하기 위해 사용하는 전통적인 메타포는 클라이언트-서버 모델이다.

## 메시지와 메시지 전송

메시지는 객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단이다. 한 객체가 다른 객체에게 도움을 요청하는 것을 메시지 전송, 메시지 패싱이라 부른다. 메시지를 전송하는 객체를 메시지 전송자라 부르고, 메시지를 수신하는 객체를 메시지 수신자라 부른다. 메시지 전송자는 클라이언트, 메시지 수신자는 서버라 부른다.

## 메시지와 메서드

메시지를 수신했을 때 실제로 실행되는 함수 또는 프로시저를 메서드라 부른다. 중요한 점은 코드 상에 동일한 이름의 변수에게 동일한 메시지를 전송하더라도 객체의 타입에 따라 실행되는 메서드가 달라질 수 있다.

## 퍼블릭 인터페이스와 오퍼레이션

객체는 안과 밖을 구분하는 뚜렷한 경계를 가지고 있다. 외부의 개게는 오직 객체가 공개하는 메시지를 통해서만 객체와 상호작용할 수 있다. 객체가 의사소통을 위해 공개하는 메시지의 집합을 퍼블릭 인터페이스라 부른다.

퍼블릭 인터페이스에 포함된 메시지를 오퍼레이션이라 부른다. 프로그래밍 언어의 관점에서 객체가 다른 객체에 메시지를 전송하면 런타임 시스템은 메시지 전송을 오퍼레이션 호출로 해석하고 메시지를 수신한 객체의 실제 타입을 기반으로 적절한 메서드를 찾아 실행한다. 퍼블릭 인터페이스와 메시지의 관점에서 보면 메서드 호출보다 오퍼레이션 호출이라는 용어를 사용하는 것이 더 적절하다.

## 시그니처

오퍼레이션의 이름과 파라미터 목록을 합쳐서 시그니처라 부른다. 오퍼레이션은 실행 코드 없이 시그니처만 정의한 것이다. 메서드는 시그니처에 구현을 더한 것이다. 일반적으로 메시지를 수신하면 오퍼레이셔느이 시그니처와 동일한 메서드가 실행된다.

## 인터페이스와 설계 품질

좋은 인터페이스는 최소한의 인터페이스와 추상적인 인터페이스라는 조건을 만족해야 한다. 인터페이스는 꼭 필요한 오퍼레이션만을 인터페이스에 포함한다. 추상적인 인터페이스가 어떻게 수행하는지(구현)이 아니라 무엇을 하는지를 표현한다.

## 디미터 법칙

객체의 내부 구조에 강하게 결합되지 않도록 협력 경로를 제한하라는 것이다. 자바의 경우 .를 이용해 메시지 전송을 표현하는 언어에서는 오직 하나의 도트만 사용하라는 말로 요약된다.

디미터라는 이름의 프로젝트를 진행하던 도중 객체들의 협력 경로를 제한하면 결합도를 효과적으로 낮출 수 있다는 사실을 발견했다.

디미터 법칙을 따르기 위해 클래스가 특정한 조건을 만족하는 대상에게만 메시지를 전송하도록 프로그래밍해야 한다. 모든 클래스 C와 C에 구현된 모든 메서드 M에 대해서, M이 메시지를 전송할 수 있는 모든 객체는 아래 서술된 클래스의 인스턴스여야 한다.

- M의 인자로 전달된 클래스
- C의 인스턴스 변수의 클래스

위 설명이 어렵다면 클래스 내부의 메서드가 아래 조건을 만족하는 인스턴스에만 메시지를 전송하도록 프로그래밍해야 한다.

- this 객체
- 메서드의 매개변수
- this의 속성
- this의 속성인 컬렉션의 요소
- 메서드 내에서 생성된 지역 객체

디미터 법칙을 따르면 부끄럼타는 코드를 작성할 수 있다. 부끄럼타는 코드란 불필요한 어떤 것도 다른 객체에게 보여주지 않으며, 다른 객체의 구현에 의존하지 않은 코드를 말한다.

디미터 법칙은 객체의 내부 구조를 묻는 메시지가 아니라 수신자에게 무언가를 시키는 메시지가 더 좋은 메시지라 속삭인다.

## 묻지 말고 시켜라

디미터 법칙은 훌륭한 메시지는 객체의 상태에 관해 묻지 말고 원하는 것을 시켜야 한다.

메세지 전송자는 메시지 수신자의 상태를 기반으로 결정을 내린 후 메시지 수신자의 상태를 바꿔어서는 안된다. 구현하고 있는 로직은 메시지 수신자가 담당해야 할 책임이다.

상태를 묻는 오퍼레이션을 행동을 요청하는 오퍼레이션으로 대체하여 인터페이스를 향상시켜라. 협력을 설계하고 객체가 수신할 메시지를 결정하는 매 순간 묻지 말고 시켜라 원칙과 디미터 법칙을 머릿속에 떠올리는 것은 퍼블릭 인터페이스의 품질을 향상시킬 수 있는 좋은 습관이다.

단순히 객체에게 시킨다고 해서 문제가 해결되는 것은 아니다. 훌륭한 인터페이스를 수확하기 위해서 어떻게 작업을 수행하는지를 노출해서는 안된다. 객체가 어떻게 하는지가 아니라 무엇을 하는지를 서술해야 한다.

## 의도를 드러내는 인터페이스

어떻게 수행하는지를 드러내는 이름이란 메서드의 내부 구현을 설명하는 이름이다. 어떻게 하느냐가 아니라 무엇을 하느냐에 따라 메서드의 이름을 짓는 패턴을 의도를 드러내는 선택자라 부른다.

## 원칙의 함정

절대적인 법칙은 아니다. 소프트웨어 설계에 법칙이란 존재하지 않는다. 법칙에는 예외가 없지만 원칙에는 예외가 넘쳐난다.

설계가 트레이드오프의 산물이라는 것이다. 설계를 적절하게 트레이드오프할 수 있는 능력이 숙련자와 초보자를 구분하는 가장 중요한 기준이다.

원칙이 현재 상황에 부적합하다고 판단이 되면 원칙을 무시하자. 원칙을 아는 것보다 중요한 것은 언제 유용하고 유용하지 않은지 판단할 수 있는 능력을 기르는 것이다.

## 디미터 법칙은 하나의 도트를 강제하는 규칙이 아니다

```java
IntStream.of(1, 15, 20, 3, 9).filter(x -> x > 10).distinct().count();
```

위의 코드는 디미터 법칙을 위반하지 않는다. IntStream이라는 동일한 클래스의 인스턴스를 반환한다. 이들은 IntStream의 인스턴스를 또 다른 IntStream 인스턴스로 변환한다.

디미터 법칙은 결합도와 관련된 것이다. 결합도가 문제가 되는 것은 내부 구조가 외부로 노출되는 것이다. IntStream의 내부 구조가 외부로 노출이 되지 않았다. 객체를 둘러싸고 있는 캡슐은 그대로 유지된다.

## 명령-쿼리 분리 원칙

명령-쿼리 분리 원칙은 퍼블릭 인터페이스에 오퍼레이션을 정의할 때 참고할 수 있는 지침을 제공한다. 절차에 묶어 호출 가능하도록 이름을 부여한 기능 모듈을 루틴이라 부른다. 루틴은 프리시저와 함수로 구분할 수 있다.

- 프로시저는 부수효과를 발생시킬 수 있지만 값을 반환할 수 없다.
- 함수는 값을 반환할 수 있지만 부수효과를 발생시킬 수 없다.

명령과 쿼리는 객체의 인터페이스 측명에서 프로시저와 함수를 부르는 또 다른 이름이다. 객체의 상태를 수정하는 오퍼레이션을 명령이라 부르고 객체와 연관된 정보를 반환하는 오퍼레이션을 쿼리라 부른다. 개념적으로 명령은 프로시저와 쿼리는 함수와 동일하다.

명령과 쿼리를 분리하기 위해서는 다음의 두 가지 규칙을 준수해야 한다.

- 객체의 상태를 변경하는 명령은 반환값을 가질 수 없다.
- 객체의 정보를 반환하는 쿼리는 상태를 변경할 수 없다.

명령-쿼리 분리 원칙을 한 문장으로 표현하면 “질문이 답변을 수정해서는 안된다”는 것이다. 명령은 상태를 변경할 수 있지만 상태를 반환해서는 안된다.

퍼블릭 인터페이스를 설계할 때 부수효과를 가지는 대신 값을 반환하지 않는 명령과, 부수효과를 가지지 않은 대신 값을 반환하는 쿼리를 분리하기 바란다. 그 결과, 코드는 예측 가능하고 이해하기 쉬우며 디버깅 용이한 동시에 유지보수하기 수월해진다.

## 명령-쿼리 분리와 참조 투명성

명령과 쿼리를 분리하여 명령형 언어의 틀 안에 참조 투명성의 장점을 제한적이나마 누릴 수 있게 된다. 참조 투명성은 특성을 잘 활용하면 버그가 적고, 디버깅이 용이하고, 쿼리의 순서에 따라 실행 결과가 변하지 않는 코드를 작성할 수 있다.

컴퓨터의 세계와 수학의 세계를 나누는 가장 큰 특징은 부수효과의 존재 유무다. 프로그램에서 부수효과를 발생시키는 두 가지 대표적인 문법은 대입 문과 함수다.

참조 투명성이란 “어떤 표현식 e가 있을 때 e의 값으로 e가 나타나는 모든 위치를 교체하더라도 결과가 달라지지 않는 특성”을 의미한다.

어떤 값이 불변한다는 말은 부수효과가 발생하지 않는다는 말과 동일하다.

- 모든 함수를 이미 알고 있는 하나의 결과값으로 대체할 수 있기 때문에 식을 쉽게 계산할 수 있다.
- 모든 곳에서 함수의 결과값이 동일하기 때문에 식의 순서를 변경하더라도 각 식의 결과는 달라지지 않는다.