# 11장 합성과 유연한 설계

## Reference

- [오브젝트 - 조영호 저자(글)](https://product.kyobobook.co.kr/detail/S000001766367)

상속은 부모 클래스와 자식 클래스를 연결하여 부모 클래스의 코드를 재사용하는 고, 합성은 전체를 표현하는 객체가 부분을 표현하는 객체를 포함해서 부분 객체의 코드를 재사용한다. 상속관계는 is-a관계이고, 합성은 has-a관계이다.

상속은 부모 클래스의 내부 구현에 대해 상세하게 알아야 하기 때문에 자식 클래스와 부모 클래스 사이의 결합도가 높아질 수 밖에 없다.

합성은 내부에 포함되는 객체의 구현이 아닌 퍼블릭 인터페이스에 의존한다. 따라서 내부 구현이 변경되더라도 영향을 최소화할 수 있기에 변경에 더 안정적인 코드를 얻을 수 있게 된다.

상속은 동적인 관계이고, 합성은 실행 시점에 동적으로 변경할 수 있다. 클래스 사이의 높은 결합도를 객체 사이의 낮은 결합도로 대체할 수 있다.

## 상속을 합성으로 변경하기

- 몽키패치: 현재 실행 중인 환경에만 영향을 미치도록 지역적으로 코드를 수정하거나 확장하는 것을 가리킨다.

## 상속으로 인한 조합의 폭발적인 증가

상속으로 결합도가 높아지면 코드를 수정하는 데 필요한 작업의 양이 과도하게 늘어나는 경향이 있다.

- 하나의 기능을 추가하거나 수정하기 위해 불필요하게 많은 수의 클래스를 추가하거나 수정해야 한다.
- 단일 상속만을 지원하는 언어에서는 상속으로 인해 오히려 중복 코드의 양이 늘어날 수 있다.

상속의 남용으로 하나의 기능을 추가하기 위해 필요 이상으로 많은 수의 클래스를 추가해야 하는 경우를 가리켜 클래스 폭발 문제 또는 조합의 폭발 문제라고 부른다.

클래스 폭발 문제는 자식 클래스가 부모 클래스의 구현에 강하게 결합되도록 강요하는 상속의 근본적인 한계 때문에 발생하는 문제다. 컴파일 타임에 결정된 자식 클래스의 부모 클래스 사이의 고나계는 변경될 수 없기에 다양한 조합이 필요할 경우 조합의 수만큼 새로운 클래스를 추가해야 한다.

## 합성 관계로 변경하기

상속관계는 컴파일타임에 결정되기에 코드를 실행하는 도중에 변경이 불가능하다. 따라서 조합 가능한 모든 경우별로 클래스를 추가해야 한다.

합성은 컴파일타임 관계를 런타임 관계로 변경하여 이 문제를 해결한다. 합성은 구현이 아닌 퍼블릭 인터페이스에 대해서만 의존할 수 있기에 런타임에 객체의 관계를 변경할 수 있다.

클래스 폭발 문제를 해결하기 위해 합성을 사용하는 이유는 런타임에 객체 사이의 의존성을 자유롭게 변경이 가능하기 때문이다.

컴파일타임 의존성과 런타임 의존성의 거리가 멀면 멀수록 설계의 복잡도가 상승하기에 코드를 이해하기 어려워진다. 하지만 설계는 변경과 유지보수를 위해 존재한다.

### 객체 합성이 상속보다 더 좋은 방법이다

상속은 코드 재사용을 위한 우하한 해결책이 아니다. 상속은 부모 클래스의 새부적인 구현에 자식 클래스를 강하게 결합시키기에 코드의 진화를 방해한다.

코드를 재사용하면서 건전한 결합도를 유지할 수 있는 더 좋은 방법은 합성을 이용하는 것이다.

그렇다면 상속은 사용하면 안될까? 사용을 상속을 사용해야 하는 경우는 언제일까?

- 상속은 구현 상속과 인터페이스 상속의 두가지로 나뉜다.
- 상속의 대한 모든 단점들은 구현 상속에 국한된다.

## 믹스인

상속을 사용하면 다른 클래스를 간편하게 재사용하고 점진적으로 확장할 수 있다. 하지만 부모 클래스와 자식 클래스가 강하게 결합되기에 수정과 확장에 취약한 설계를 낳게 된다.

합성이 상속과 같은 문제점을 초래하지 않는 이유는 클래스의 구체적인 구현이 아닌 객체의 추상적인 인터페이스에 의존하기 때문이다.

구체적인 코드를 재사용하면서 낮은 결합도를 유지할 수 있는 유일한 방법은 재사용에 적합한 추상화를 도입하는 것이다.

믹스인은 객체를 생성할 때 코드 일부를 클래스 안에 섞어 넣어 재사용하는 기법이다. 믹스인은 컴파일 시점에 필요한 코드 조각을 조합하는 재사용 방법이다.

믹스인은 코드 재사용에 특화된 방법이면서도 상속과 같은 결합도 문제를 초래하지 않는다. 믹스인은 합성처럼 유연하고, 상속처럼 쉽게 코드를 재사용할 수 있다.

믹스인을 추상 서브클래스라고 부르기도 한다.

믹스인의 이러한 특징을 쌓을 수 있는 변경이라고 부른다.